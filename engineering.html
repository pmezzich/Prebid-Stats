
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ng</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #062f4f;
      color: white;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    .filters {
      margin: 20px;
    }
    select {
      padding: 5px;
      margin: 5px;
    }
    .chart-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    canvas {
      width: 600px !important;
      height: 400px !important;
      margin: 20px;
    }
  </style>
</head>
<body>
  <h1>Example Visualizations<br/><em>Prebid Engineering</em></h1>
  <div class="filters">
    <label for="timeFilter">Filter by:</label>
    <select id="timeFilter">
      <option>All Time</option>
    </select>
    <select id="companyFilter">
      <option>All Companies</option>
    </select>
    <select id="nameFilter">
      <option>All Names</option>
    </select>
  </div>
  <div class="chart-container">
    <canvas id="closersChart"></canvas>
    <canvas id="contributorsChart"></canvas>
    <canvas id="commentsChart"></canvas>
  </div>

  <script>
    async function loadData() {
      const res = await fetch("https://prebid-graphs-default-rtdb.firebaseio.com/individuals/2025-07.json");
      const rawData = await res.json();
      if (!rawData) return;

      const data = Object.entries(rawData).map(([person, info]) => ({
        name: person,
        company: info.company || "Unknown",
        prs: info.prs || 0,
        issues: info.issues || 0,
        comments: info.comments || 0,
        member: info.member
      }));

      const sortedByClosers = [...data].sort((a, b) => b.issues - a.issues).slice(0, 10);
      const sortedByContributors = [...data].sort((a, b) => b.prs - a.prs).slice(0, 10);
      const sortedByComments = [...data].sort((a, b) => b.comments - a.comments).slice(0, 10);

      function createChart(canvasId, labels, values, colors, title) {
        new Chart(document.getElementById(canvasId), {
          type: "bar",
          data: {
            labels,
            datasets: [{
              label: title,
              data: values,
              backgroundColor: colors
            }]
          },
          options: {
            indexAxis: "y",
            responsive: true,
            plugins: {
              legend: { display: false },
              title: {
                display: true,
                text: title,
                color: "white",
                font: { size: 18 }
              }
            },
            scales: {
              x: { ticks: { color: "white" }, grid: { color: "#234" } },
              y: { ticks: { color: "white" }, grid: { color: "#234" } }
            }
          }
        });
      }

      createChart(
        "closersChart",
        sortedByClosers.map(d => `${d.name} (${d.company})`),
        sortedByClosers.map(d => d.issues),
        sortedByClosers.map(d => d.member ? "orange" : "cornflowerblue"),
        "Top Closers"
      );

      createChart(
        "contributorsChart",
        sortedByContributors.map(d => `${d.name} (${d.company})`),
        sortedByContributors.map(d => d.prs),
        sortedByContributors.map(d => d.member ? "orange" : "cornflowerblue"),
        "Top Contributors"
      );

      createChart(
        "commentsChart",
        sortedByComments.map(d => `${d.name} (${d.company})`),
        sortedByComments.map(d => d.comments),
        sortedByComments.map(d => d.member ? "orange" : "cornflowerblue"),
        "Top by Comments"
      );
    }

    loadData();
  </script>
</body>
</html>
